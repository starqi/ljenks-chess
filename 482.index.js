"use strict";(self.webpackChunkljenks_chess=self.webpackChunkljenks_chess||[]).push([[482],{557:(e,t,n)=>{n.d(t,{or:()=>p,De:()=>y,Ke:()=>v,Qw:()=>_,F$:()=>w,Ih:()=>E,yq:()=>q,gk:()=>S,ug:()=>C,Or:()=>k});var r=n(128);e=n.hmd(e);const i=new Array(32).fill(void 0);function o(e){return i[e]}i.push(void 0,null,!0,!1);let s=i.length;let a=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});a.decode();let d=null;function c(){return null!==d&&d.buffer===r.memory.buffer||(d=new Uint8Array(r.memory.buffer)),d}function h(e,t){return a.decode(c().subarray(e,e+t))}function l(e){return()=>{throw new Error(`${e} is not defined`)}}let u=0,g=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const m="function"==typeof g.encodeInto?function(e,t){return g.encodeInto(e,t)}:function(e,t){const n=g.encode(e);return t.set(n),{read:e.length,written:n.length}};let f=null;function b(){return null!==f&&f.buffer===r.memory.buffer||(f=new Int32Array(r.memory.buffer)),f}class p{static __wrap(e){const t=Object.create(p.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_main_free(e)}static new(){var e=r.main_new();return p.__wrap(e)}make_ai_move(){r.main_make_ai_move(this.ptr)}refresh_player_moves(){r.main_refresh_player_moves(this.ptr)}try_move(e,t,n,i){return 0!==r.main_try_move(this.ptr,e,t,n,i)}get_piece(e,t){return r.main_get_piece(this.ptr,e,t)}}function y(e,t){console.log(h(e,t))}function v(e,t){console.error(h(e,t))}const _="function"==typeof Math.random?Math.random:l("Math.random"),w="function"==typeof Date.now?Date.now:l("Date.now");function E(){return function(e){s===i.length&&i.push(i.length+1);const t=s;return s=i[t],i[t]=e,t}(new Error)}function q(e,t){var n=function(e,t,n){if(void 0===n){const n=g.encode(e),r=t(n.length);return c().subarray(r,r+n.length).set(n),u=n.length,r}let r=e.length,i=t(r);const o=c();let s=0;for(;s<r;s++){const t=e.charCodeAt(s);if(t>127)break;o[i+s]=t}if(s!==r){0!==s&&(e=e.slice(s)),i=n(i,r,r=s+3*e.length);const t=c().subarray(i+s,i+r);s+=m(e,t).written}return u=s,i}(o(t).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),i=u;b()[e/4+1]=i,b()[e/4+0]=n}function S(e,t){try{console.error(h(e,t))}finally{r.__wbindgen_free(e,t)}}function C(e){!function(e){const t=o(e);(function(e){e<36||(i[e]=s,s=e)})(e)}(e)}function k(e,t){throw new Error(h(e,t))}},482:(e,t,n)=>{n.r(t);var r=n(557);const i={bb:n.p+"0180c5827bceece87dc3abdae65482ef.png",bw:n.p+"11f4961ce6da7780b8b871f4b2088514.png",kb:n.p+"e48feabdd563479eefc8591390c18d1c.png",kw:n.p+"ae8822a6c7a3fe3d4bc456aac92e680b.png",nb:n.p+"69534b953181e0c4d0335d4bee6364e7.png",nw:n.p+"48a5392547eb9403d668d19c1dee23ea.png",pb:n.p+"de55e4cb5f4b5acf62ee872a3a5b0cca.png",pw:n.p+"4c3cc6fc5c61c9ac11a2c3476612ee82.png",qb:n.p+"9cab050258aa5fc071d990ece6e66816.png",qw:n.p+"7eeecfe963b7301bfc8797e2532bd71b.png",rb:n.p+"55c06d7782205f329641b3114d5db7e6.png",rw:n.p+"271e9073e2fb4ece87ef62715f2bdf9e.png"};new class{constructor(){this.boardLock=!1,this.draggedImage=null,this.draggedSqX=0,this.draggedSqY=0,this.main=r.or.new(),this.LEN=.9*Math.min(window.innerWidth,window.innerHeight-document.getElementById("title").getBoundingClientRect().height)/8>>>0,this.numToLetter=["p","r","n","b","q","k"],this.board=document.getElementById("board"),this.board.addEventListener("mousedown",this.onBoardMouseDown.bind(this)),this.board.addEventListener("mousemove",this.onBoardMouseMove.bind(this)),this.board.addEventListener("mouseup",this.onBoardMouseUp.bind(this)),this.board.addEventListener("touchstart",this.onTouchStart.bind(this)),this.board.addEventListener("touchmove",this.onTouchMove.bind(this)),this.board.addEventListener("touchend",this.onTouchEnd.bind(this)),this.dragged=document.getElementById("dragged"),this.dragged.width=this.LEN,this.dragged.height=this.LEN,this.squareImages=[],this.wasmData=new Array(64);for(let e=0;e<8;++e){const t=document.createElement("div"),n=[],r=e%2==0?0:1;for(let e=0;e<8;++e){const i=document.createElement("span");i.style.width=this.LEN,i.style.height=this.LEN,i.style.display="inline-block",i.style.backgroundColor=(e+r)%2==0?"#eeeeee":"#915355",i.dataset.backgroundColor=i.style.backgroundColor;const o=new Image;o.width=this.LEN,o.height=this.LEN,o.style.visibility="hidden",o.src="",i.append(o),t.append(i),n.push(o)}this.board.append(t),this.squareImages.push(n)}this.isPlayerWhite=Math.random()>.5,this.isPlayerWhite||this.main.make_ai_move(),this.main.refresh_player_moves(),this.updateFromWasm()}onGenericDragStart(e,t){if(this.boardLock)return;null!==this.draggedImage&&(this.draggedImage.style.visibility="visible");const n=this.getSquareCoordsFromClientCoords(e,t),r=this.squareImages[n.y];if(void 0===r)return;const i=r[n.x];void 0!==i&&"hidden"!==i.style.visibility&&(i.style.visibility="hidden",this.draggedImage=i,this.dragged.src=i.src,this.dragged.style.visibility="visible",this.draggedSqY=n.y,this.draggedSqX=n.x,this.trySyncDragged(e,t))}trySyncDragged(e,t){const n=this.getBoardCoordsFromClientCoords(e,t);null!==this.draggedImage&&(this.dragged.style.left=n.x-this.LEN/2,this.dragged.style.top=n.y-this.LEN/2)}onGenericDragEnd(e,t){if(null===this.draggedImage)return;this.draggedImage.style.visibility="visible",this.draggedImage=null,this.dragged.style.visibility="hidden";const n=this.getSquareCoordsFromClientCoords(e,t);if(this.isPlayerWhite){if(!this.main.try_move(this.draggedSqX,this.draggedSqY,n.x,n.y))return}else if(!this.main.try_move(7-this.draggedSqX,7-this.draggedSqY,7-n.x,7-n.y))return;this.updateFromWasm(),this.boardLock=!0,console.log("Locked board"),setTimeout((()=>{this.main.make_ai_move(),this.updateFromWasm(),this.main.refresh_player_moves(),this.boardLock=!1,console.log("Unlocked board")}),250)}onBoardMouseDown(e){e.preventDefault(),this.onGenericDragStart(e.clientX,e.clientY)}onBoardMouseMove(e){e.preventDefault(),this.trySyncDragged(e.clientX,e.clientY)}onBoardMouseUp(e){e.preventDefault(),this.onGenericDragEnd(e.clientX,e.clientY)}onTouchStart(e){1===e.touches.length&&this.onGenericDragStart(e.touches[0].clientX,e.touches[0].clientY)}onTouchMove(e){1==e.touches.length&&(e.preventDefault(),this.trySyncDragged(e.touches[0].clientX,e.touches[0].clientY))}onTouchEnd(e){0===e.touches.length&&1===e.changedTouches.length?this.onGenericDragEnd(e.changedTouches[0].clientX,e.changedTouches[0].clientY):this.onGenericDragEnd(-1,-1)}setSquareFromWasm(e,t){const n=this.wasmData[8*e+t],r=this.isPlayerWhite?this.main.get_piece(t,e):this.main.get_piece(7-t,7-e);if(n===r)this.colorSquare(e,t,!1);else{if(0===r)this.setSquare(e,t,null);else{const n=r>0,i=this.numToLetter[Math.abs(r)-1];void 0!==i&&this.setSquare(e,t,i,n)}this.wasmData[8*e+t]=r,void 0!==n&&this.colorSquare(e,t,!0)}return r}colorSquare(e,t,n){const r=this.squareImages[e];if(void 0===r)return;const i=r[t];void 0!==i&&(i.parentElement.style.backgroundColor=n?"#a33c2c":i.parentElement.dataset.backgroundColor)}setSquare(e,t,n,r){const o="string"==typeof n?i[n.toLowerCase()+(r?"w":"b")]:null;return this._setSquare(e,t,o)}_setSquare(e,t,n){const r=this.squareImages[e];if(void 0===r)return;const i=r[t];void 0!==i&&(n?(i.src=n,i.style.visibility="visible"):(i.src="",i.style.visibility="hidden"))}updateFromWasm(){for(let e=0;e<8;++e)for(let t=0;t<8;++t)this.setSquareFromWasm(t,e)}getBoardCoordsFromClientCoords(e,t){const n=this.board.getBoundingClientRect();return{x:e-n.left,y:t-n.top}}getSquareCoordsFromClientCoords(e,t){const n=this.getBoardCoordsFromClientCoords(e,t);return n.x=n.x/this.LEN>>>0,n.y=n.y/this.LEN>>>0,n}}},128:(e,t,n)=>{var r=n.w[e.id];e.exports=r,n(557),r[""]()}}]);